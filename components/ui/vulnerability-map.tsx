"use client"

import { FileCode, Folder, AlertCircle, ShieldCheck, ChevronRight } from "lucide-react"
import { type AuditLog } from "@/lib/audit-logic"

interface VulnerabilityMapProps {
  logs: AuditLog[]
}

export function VulnerabilityMap({ logs }: VulnerabilityMapProps) {
  // We simulate a file tree and check if any log text mentions these specific files
  const files = [
    { name: "src/api/auth.ts", type: "file" },
    { name: "src/lib/db.ts", type: "file" },
    { name: ".env.production", type: "file" },
    { name: "package.json", type: "file" },
    { name: "docker-compose.yml", type: "file" },
  ]

  const getFileStatus = (fileName: string) => {
    const hasError = logs.some(l => l.type === "error" && l.text.includes(fileName))
    const hasWarning = logs.some(l => l.type === "warning" && l.text.includes(fileName))
    
    if (hasError) return "error"
    if (hasWarning) return "warning"
    return "clean"
  }

  return (
    <div className="rounded-xl border border-border bg-card/50 backdrop-blur-sm overflow-hidden h-full flex flex-col">
      <div className="p-4 border-b border-border flex items-center justify-between bg-muted/20">
        <h3 className="text-xs font-bold uppercase tracking-widest flex items-center gap-2">
          <Folder className="h-4 w-4 text-primary" />
          Vulnerability Map
        </h3>
        <div className="flex gap-2">
          <div className="flex items-center gap-1">
            <div className="h-2 w-2 rounded-full bg-destructive" />
            <span className="text-[9px] text-muted-foreground uppercase font-bold">Crit</span>
          </div>
          <div className="flex items-center gap-1">
            <div className="h-2 w-2 rounded-full bg-emerald-500" />
            <span className="text-[9px] text-muted-foreground uppercase font-bold">Safe</span>
          </div>
        </div>
      </div>

      <div className="p-4 space-y-2 overflow-y-auto">
        <div className="flex items-center gap-2 text-[11px] font-bold text-muted-foreground mb-2">
          <ChevronRight className="h-3 w-3 rotate-90" /> root / project
        </div>
        
        {files.map((file) => {
          const status = getFileStatus(file.name)
          return (
            <div 
              key={file.name}
              className={`flex items-center justify-between p-2 rounded-md border transition-all ${
                status === 'error' ? 'bg-destructive/10 border-destructive/30' : 
                status === 'warning' ? 'bg-amber-500/10 border-amber-500/30' : 
                'bg-muted/5 border-transparent'
              }`}
            >
              <div className="flex items-center gap-3">
                <FileCode className={`h-4 w-4 ${status === 'error' ? 'text-destructive' : 'text-muted-foreground'}`} />
                <span className={`text-xs font-mono ${status === 'error' ? 'text-destructive font-bold' : 'text-foreground'}`}>
                  {file.name}
                </span>
              </div>
              
              {status === "error" ? (
                <AlertCircle className="h-3.5 w-3.5 text-destructive animate-pulse" />
              ) : status === "warning" ? (
                <AlertCircle className="h-3.5 w-3.5 text-amber-500" />
              ) : (
                <ShieldCheck className="h-3.5 w-3.5 text-emerald-500/50" />
              )}
            </div>
          )
        })}
      </div>
      
      <div className="mt-auto p-3 bg-muted/30 border-t border-border">
        <p className="text-[9px] text-center text-muted-foreground italic font-mono">
          [ LIVE SECURITY HEURISTICS ACTIVE ]
        </p>
      </div>
    </div>
  )
}